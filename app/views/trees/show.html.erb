<div class="modal fade" id="invite" tabindex="-1" role="form" aria-labelledby="invite-friends" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Invite friends</h4>
      </div>
      <div class="modal-body">
        <%= form_tag create_invitations_path(@tree, @branch), :remote => true do %>
        <%= label_tag :invitations, "Please comma-separate your friends' emails:" %>
        <%= text_area :invitations, "", :class => "form-control" %><br />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <%= submit_tag "Send", :class => "btn btn-success" %>
        <% end %> 
      </div>
    </div>
  </div>
</div>


<%= render "shared/compass" %> 
<svg width="700" height="400" class="vis"></svg>
<%= render "shared/show" %> 


<script>



$(document).ready(function () {
  var tree_id_regex = new RegExp("trees/.*\.")
  // console.log(window.location.href)
  var tree_id = window.location.href.match(tree_id_regex)
  if (tree_id)
    {var tree_id = tree_id[0].split("/")[1]}
  else
    {var tree_id = ""}

  var link = window.location + ".json" + "?current_branch=" + tree_id
  // console.log(link);
  d3.json(link, function(error, data) {
    if (error) {
      tree = null
    }
    else if(data) {
      tree = new Tree(data);
      tree.draw(data); 
      $(".story-panel").addClass("open");
      $(".instruction").addClass("closed");
      var duration = 5000,
      timer = setInterval(update, duration);

    }  
  });
});

</script>